# Sub-flow: Clean up any existing games
# Expects: User logged in, on home screen with "New Game" visible
# Provides: All games deleted, ready to create new game

appId: golf.spicy
---

# Take screenshot to see initial state
- takeScreenshot: cleanup_before

# Try to delete games if any exist
# We repeat up to 10 times to handle multiple games
- repeat:
    times: 10
    commands:
      # Check if a game exists and delete it
      - runFlow:
          when:
            visible:
              id: "game-list-item"
          commands:
            # Tap the first game to open it
            - tapOn:
                id: "game-list-item"
                index: 0

            # Wait for game to load
            - waitForAnimationToEnd:
                timeout: 5000

            # Navigate to settings (gear icon or Settings tab)
            - tapOn: "Settings"

            # Wait for settings screen
            - waitForAnimationToEnd:
                timeout: 3000

            # Scroll to find Delete Game button
            - scrollUntilVisible:
                element:
                  text: "Delete Game"
                direction: DOWN
                timeout: 5000

            # Tap Delete Game
            - tapOn: "Delete Game"

            # Confirm deletion in modal
            - extendedWaitUntil:
                visible: "Delete"
                timeout: 3000
            - tapOn:
                text: "Delete"
                index: 1  # Second "Delete" button (the confirm one)

            # Wait for navigation back to games list
            - extendedWaitUntil:
                visible: "New Game"
                timeout: 5000

            # Small delay before checking for more games
            - waitForAnimationToEnd:
                timeout: 1000

# Take screenshot to confirm cleanup
- takeScreenshot: cleanup_after
