# Sub-flow: Clean up any existing games
# Expects: User logged in, on home screen with "New Game" visible
# Provides: All games deleted, ready to create new game
#
# This is a reusable sub-flow that can be called from any test flow.
# For standalone cleanup (with login), use cleanup_games.yaml instead.

appId: golf.spicy
---
# Take screenshot to see initial state
- takeScreenshot: cleanup_before

# Try to delete games if any exist
# We repeat up to 10 times to handle multiple games
- repeat:
    times: 10
    commands:
      # Check if a game exists and delete it
      - runFlow:
          when:
            visible:
              id: "game-list-item"
          commands:
            # Tap settings icon directly (faster than opening game first)
            - tapOn:
                id: "game-list-item-settings"
                index: 0

            # Wait for settings screen
            - waitForAnimationToEnd:
                timeout: 3000

            # Tap Options tab (Delete Game is there)
            - tapOn: "Options"

            - waitForAnimationToEnd:
                timeout: 1000

            # Scroll to find Delete Game button
            - scrollUntilVisible:
                element:
                  id: "delete-game-button"
                direction: DOWN
                timeout: 5000

            # Tap Delete Game
            - tapOn:
                id: "delete-game-button"

            # Confirm deletion in modal - use text since testID in Modal may not be accessible
            - waitForAnimationToEnd:
                timeout: 1000
            - tapOn:
                text: "Delete"
                index: 1

            # Wait for navigation back to games list
            - extendedWaitUntil:
                visible: "New Game"
                timeout: 5000

            # Small delay before checking for more games
            - waitForAnimationToEnd:
                timeout: 1000

# Take screenshot to confirm cleanup
- takeScreenshot: cleanup_after
